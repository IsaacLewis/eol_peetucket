#bhl_wrapper.text_object
  %table{ :cellspacing => "5", :border => "0", :width => "100%", :cellpadding => "5" }
    %tr
      %td{ :valign => "top" }
        = external_link_to(image_tag('/images/bhl_logo.gif'),"http://www.biodiversitylibrary.org", {:show_link_icon => false})
      %td
        %span.smalltext
          The following bibliography has been generated by automated services. BHL uses taxonomic intelligence tools to locate, verify, and record scientific names located within the text of each digitized page in the BHL digital collection.
        %br
        %a#bhl_link{ :href => "", :name => "bhl_link", :target => "_blank" }
          View Discovered Bibliography in BHL
        = external_link_icon
  :javascript
    $('bhl_link').href='#{external_link_url}?url=' + encodeURI('http://www.biodiversitylibrary.org/name/' + $('canonical_form').value);
  - unless @content[:items].empty?
    - if @content[:items].collect {|item| item["publication_title"] }.uniq.size > 1
      .divider
      %table.results_table{ :cellspacing => "0", :summary => "TOC" }
        %tr
          %th
            BHL Summary
        - bhl_page_title = ''
        - @content[:items].each_with_index do  |content_item, counter|
          - unless bhl_page_title == hh(content_item["publication_title"])
            - bhl_page_title = hh(content_item["publication_title"])
            - column_class=cycle('odd','even')
            %tr
              %td{:class => column_class}
                %a{ :href => "#BHL%3C%=counter.to_s%%3E" }= hh(content_item["publication_title"])
                %br
                %span.smalltext
    .divider
    - bhl_page_title = ''
    - @content[:items].each_with_index do |content_item, counter|
      - if content_item["publication_title"] != bhl_page_title
        - unless bhl_page_title.empty?
          .divider
      - bhl_page_title = hh(content_item["publication_title"])
      %a{ :name => "BHL#{counter.to_s}" }
      %h2= external_link_to(hh(content_item["publication_title"]),hh(content_item["publication_url"]))
      %span.smalltext= hh(content_item["publication_details"])
      %table.results_table{ :cellspacing => "0", :summary => "Links" }
        %tr
          %th
            Pages
        - column_class=cycle('odd','even')
        - item_name =  ""
        - item_name += content_item["item_year"] + ". " unless content_item["item_year"] == '' or content_item["item_year"] == '0'
        - item_name +="Vol. " + content_item["item_volume"] + ", " unless content_item["item_volume"] == '' or content_item["item_volume"] = '0'
        - item_name += "Issue " + content_item["item_issue"] + ", " unless content_item["item_issue"] == '' or content_item["item_issue"] = '0'
        - item_name += external_link_to('Page ' + content_item["item_number"], content_item["item_url"])
        %tr
          %td{:class => column_class}= item_name
  .divider
  .divider
  .content-attribution-area
    .attribution-header.text-area-header= "Source and Additional Information"[]
    %span.source 
      Content provided by the 
      =external_link_to("Biodiversity Heritage Library","http://www.biodiversitylibrary.org/")
